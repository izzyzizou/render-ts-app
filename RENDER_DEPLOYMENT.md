# Render Deployment Guide

This guide will help you deploy your Find My Family backend to Render.

## Prerequisites

1. A [Render](https://render.com/) account (free tier available)
2. A GitHub account with this repository pushed
3. (Optional) A [Neon](https://neon.tech/) account for PostgreSQL (or use Render's managed PostgreSQL)

## Step 1: Push to GitHub

Make sure your code is pushed to a GitHub repository:

```bash
git add .
git commit -m "Prepare for Render deployment"
git push origin main
```

## Step 2: Connect to Render

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click **"New +"** â†’ **"Blueprint"**
3. Connect your GitHub account if you haven't already
4. Select your repository: `find-my-family-backend`
5. Render will automatically detect the `render.yaml` file

## Step 3: Review Blueprint Configuration

Render will show you the services that will be created:

### Web Service
- **Name**: `find-my-family-backend`
- **Environment**: Node.js
- **Plan**: Free
- **Build Command**: `npm install && npm run build`
- **Start Command**: `npm start`
- **Port**: 10000

### PostgreSQL Database
- **Name**: `find-my-family-db`
- **Plan**: Free
- **Database Name**: `family_location_db`
- **User**: `family_admin`

### Environment Variables (Auto-configured)
- `NODE_ENV`: `production`
- `PORT`: `10000`
- `DATABASE_URL`: Automatically linked from the database
- `JWT_SECRET`: Auto-generated by Render

## Step 4: Apply Blueprint

1. Click **"Apply"** to create all services
2. Wait for the database to be created first
3. Then the web service will start building

## Step 5: Initialize Database Schema

After the database is created, you need to run the schema:

### Option A: Using Render Shell (Recommended)

1. Go to your database service in Render Dashboard
2. Click on **"Connect"** tab
3. Copy the **"External Connection String"**
4. Open a terminal and run:
   ```bash
   psql "YOUR_CONNECTION_STRING" -f schema.sql
   ```

### Option B: Using Render Shell

1. Go to your database service
2. Click **"Shell"** tab
3. Run:
   ```bash
   psql $DATABASE_URL -f schema.sql
   ```

### Option C: Using npm script (if you have psql locally)

1. Get the connection string from Render Dashboard
2. Set it temporarily:
   ```bash
   export DATABASE_URL="your-connection-string"
   npm run db:init
   ```

## Step 6: Verify Deployment

1. Check the web service logs in Render Dashboard
2. Visit your service URL: `https://find-my-family-backend.onrender.com/health`
3. You should see: `{"status":"ok","uptime":...}`

## Step 7: Test Your API

Your API will be available at:
- Base URL: `https://find-my-family-backend.onrender.com`
- Health Check: `https://find-my-family-backend.onrender.com/health`
- Auth: `https://find-my-family-backend.onrender.com/api/auth/register`
- Locations: `https://find-my-family-backend.onrender.com/api/locations`

## Troubleshooting

### Build Fails
- Check build logs in Render Dashboard
- Ensure all dependencies are in `package.json`
- Verify TypeScript compiles: `npm run build` locally

### Database Connection Issues
- Verify `DATABASE_URL` is set correctly
- Check database is running (green status in Render)
- Ensure SSL is enabled (already configured in `db.ts`)

### Service Won't Start
- Check logs for errors
- Verify `PORT` environment variable is set
- Ensure `dist/index.js` exists after build

### Schema Not Applied
- Make sure you're using the correct connection string
- Check that the database user has CREATE permissions
- Verify `schema.sql` file is in the repository

## Environment Variables

If you need to add custom environment variables:

1. Go to your web service in Render Dashboard
2. Click **"Environment"** tab
3. Add any additional variables needed

## Updating Your Deployment

After pushing changes to GitHub:

1. Render will automatically detect changes (if auto-deploy is enabled)
2. Or manually trigger a deploy from the Render Dashboard
3. The service will rebuild and restart

## Free Tier Limitations

- Services spin down after 15 minutes of inactivity
- First request after spin-down may take 30-60 seconds
- Database has limited storage (1 GB on free tier)
- Consider upgrading for production use

## Next Steps

- Set up a custom domain (available on paid plans)
- Configure CORS for your frontend domain
- Set up monitoring and alerts
- Consider using Render's managed PostgreSQL or Neon for better performance
